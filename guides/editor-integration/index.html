<!DOCTYPE html>









<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Integrating TLEX with code editors for syntax highlighting">
    <title>Editor Integration - TLEX</title>

    
    <script>
        (function() {
            var theme = localStorage.getItem('theme');
            if (theme === 'dark' || (!theme && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                document.documentElement.classList.add('dark');
            }
        })();
    </script>

    
    <link rel="stylesheet" href="/tlex/static/css/tsappkit-docs.css">
    <link rel="stylesheet" href="/tlex/static/css/main.css">
    

    
    <link rel="icon" type="image/png" href="/tlex/static/images/favicon.png">
</head>
<body class="">
    
    
<header class="site-header">
    <div class="header-container">
        
        <div class="logo">
            <a href="/tlex/">
                <span class="logo-text">TLEX</span>
            </a>
        </div>

        <nav class="main-nav">
            
            
            <div class="nav-item">
                <a href="/tlex/getting-started/" class="nav-link">
                    
                    Getting Started
                </a>
                
            </div>
            
            <div class="nav-item">
                <a href="/tlex/playground/" class="nav-link">
                    
                    Playground
                </a>
                
            </div>
            
            <div class="nav-item has-children">
                <a href="/tlex/concepts/" class="nav-link">
                    
                    Concepts
                </a>
                
                <div class="nav-dropdown">
                    
                    <a href="/tlex/concepts/regex-ast/" class="dropdown-item">Regex AST</a>
                    
                    <a href="/tlex/concepts/vm-architecture/" class="dropdown-item">VM Architecture</a>
                    
                </div>
                
            </div>
            
            <div class="nav-item has-children">
                <a href="/tlex/reference/" class="nav-link">
                    
                    Reference
                </a>
                
                <div class="nav-dropdown">
                    
                    <a href="/tlex/reference/api/" class="dropdown-item">API Reference</a>
                    
                    <a href="/tlex/reference/incremental-tokenizer/" class="dropdown-item">Incremental Tokenizer</a>
                    
                    <a href="/tlex/reference/js-regex-syntax/" class="dropdown-item">JavaScript Regex</a>
                    
                    <a href="/tlex/reference/flex-syntax/" class="dropdown-item">Flex Syntax</a>
                    
                    <a href="/tlex/reference/rule-config/" class="dropdown-item">Rule Config</a>
                    
                    <a href="/tlex/reference/tokenizer-states/" class="dropdown-item">Tokenizer States</a>
                    
                </div>
                
            </div>
            
            <div class="nav-item has-children">
                <a href="/tlex/guides/" class="nav-link">
                    
                    Guides
                </a>
                
                <div class="nav-dropdown">
                    
                    <a href="/tlex/guides/editor-integration/" class="dropdown-item">Editor Integration</a>
                    
                </div>
                
            </div>
            
            <div class="nav-item has-children">
                <a href="/tlex/examples/" class="nav-link">
                    
                    Examples
                </a>
                
                <div class="nav-dropdown">
                    
                    <a href="/tlex/examples/json-tokenizer/" class="dropdown-item">JSON Tokenizer</a>
                    
                    <a href="/tlex/examples/calculator/" class="dropdown-item">Calculator</a>
                    
                    <a href="/tlex/examples/c-lexer/" class="dropdown-item">C Lexer</a>
                    
                </div>
                
            </div>
            
        </nav>

        <div class="header-actions">
            <button class="theme-toggle" id="theme-toggle" aria-label="Toggle dark mode" title="Toggle dark mode">
                
                <svg class="icon-sun" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
                </svg>
                
                <svg class="icon-moon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
                </svg>
            </button>
            <a href="https://github.com/panyam/tlex" class="btn-github" target="_blank" rel="noopener">
                GitHub
            </a>
        </div>
    </div>
</header>


    
    <div class="page-container">
        
        
<aside class="sidebar">
    <div class="sidebar-content">
        

        
        <nav class="section-nav">
            
            <div class="section-nav-content">
                <h3>Guides</h3>
                <ul>
                    <li><a href="/tlex/guides/">Overview</a></li>
                    <li><a href="/tlex/guides/editor-integration/">Editor Integration</a></li>
                </ul>
            </div>
            
        </nav>
    </div>
</aside>


        
        <main class="main-content">
            
<article class="content">
    
    
    <header class="content-header">
        <h1>Editor Integration</h1>
        
        <p class="lead">Integrating TLEX with code editors for syntax highlighting</p>
        
    </header>
    

    
    <div class="content-body">
        
            
            
            <p>This guide covers integrating TLEX&rsquo;s incremental tokenizer with code editors for real-time syntax highlighting. Whether you&rsquo;re building a custom editor, integrating with Monaco, CodeMirror, or Ace, the patterns here will help you achieve responsive highlighting.</p>
<h2 id="architecture-overview">Architecture Overview <a class="anchor" href="#architecture-overview">¶</a></h2>
<pre><code><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;"><code><span style="display:flex;"><span>┌─────────────────────────────────────────────────────────┐
</span></span><span style="display:flex;"><span>│                      Editor                             │
</span></span><span style="display:flex;"><span>│  ┌──────────────────────────────────────────────────┐   │
</span></span><span style="display:flex;"><span>│  │                   Document                       │   │
</span></span><span style="display:flex;"><span>│  │                                                  │   │
</span></span><span style="display:flex;"><span>│  │  &#34;function add(a, b) { return a + b; }&#34;          │   │
</span></span><span style="display:flex;"><span>│  └──────────────────────────────────────────────────┘   │
</span></span><span style="display:flex;"><span>│                         │                               │
</span></span><span style="display:flex;"><span>│                    Edit Events                          │
</span></span><span style="display:flex;"><span>│                         ▼                               │
</span></span><span style="display:flex;"><span>│  ┌──────────────────────────────────────────────────┐   │
</span></span><span style="display:flex;"><span>│  │            IncrementalTokenizer                  │   │
</span></span><span style="display:flex;"><span>│  │                                                  │   │
</span></span><span style="display:flex;"><span>│  │  - Tracks token cache                            │   │
</span></span><span style="display:flex;"><span>│  │  - Computes minimal re-tokenization              │   │
</span></span><span style="display:flex;"><span>│  │  - Accumulates rapid edits                       │   │
</span></span><span style="display:flex;"><span>│  └──────────────────────────────────────────────────┘   │
</span></span><span style="display:flex;"><span>│                         │                               │
</span></span><span style="display:flex;"><span>│                    Token Stream                         │
</span></span><span style="display:flex;"><span>│                         ▼                               │
</span></span><span style="display:flex;"><span>│  ┌──────────────────────────────────────────────────┐   │
</span></span><span style="display:flex;"><span>│  │              Syntax Highlighter                  │   │
</span></span><span style="display:flex;"><span>│  │                                                  │   │
</span></span><span style="display:flex;"><span>│  │  - Maps tokens to CSS classes                    │   │
</span></span><span style="display:flex;"><span>│  │  - Updates DOM/canvas                            │   │
</span></span><span style="display:flex;"><span>│  └──────────────────────────────────────────────────┘   │
</span></span><span style="display:flex;"><span>└─────────────────────────────────────────────────────────┘
</span></span></code></pre></code></pre><h2 id="basic-integration">Basic Integration <a class="anchor" href="#basic-integration">¶</a></h2>
<h3 id="step-1-define-your-tokenizer">Step 1: Define Your Tokenizer <a class="anchor" href="#step-1-define-your-tokenizer">¶</a></h3>
<pre><code><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;"><code><span style="display:flex;"><span><span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">Tokenizer</span>, <span style="color:#a6e22e">IncrementalTokenizer</span> } <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#34;tlex&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">createJavaScriptTokenizer</span>()<span style="color:#f92672">:</span> <span style="color:#a6e22e">IncrementalTokenizer</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">tokenizer</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Tokenizer</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Keywords
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">tokenizer</span>.<span style="color:#a6e22e">add</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">/\b(function|return|if|else|for|while|const|let|var|class|extends|import|export|default|from|async|await)\b/</span>,
</span></span><span style="display:flex;"><span>    { <span style="color:#a6e22e">tag</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;keyword&#34;</span>, <span style="color:#a6e22e">priority</span>: <span style="color:#66d9ef">10</span> }
</span></span><span style="display:flex;"><span>  );
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Built-in values
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">tokenizer</span>.<span style="color:#a6e22e">add</span>(<span style="color:#e6db74">/\b(true|false|null|undefined|NaN|Infinity)\b/</span>, {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">tag</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;builtin&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">priority</span>: <span style="color:#66d9ef">10</span>
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Numbers
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">tokenizer</span>.<span style="color:#a6e22e">add</span>(<span style="color:#e6db74">/0x[0-9a-fA-F]+|\d+\.?\d*(?:[eE][+-]?\d+)?/</span>, { <span style="color:#a6e22e">tag</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;number&#34;</span> });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Strings
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">tokenizer</span>.<span style="color:#a6e22e">add</span>(<span style="color:#e6db74">/&#34;(?:[^&#34;\\]|\\.)*&#34;/</span>, { <span style="color:#a6e22e">tag</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;string&#34;</span> });
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">tokenizer</span>.<span style="color:#a6e22e">add</span>(<span style="color:#e6db74">/&#39;(?:[^&#39;\\]|\\.)*&#39;/</span>, { <span style="color:#a6e22e">tag</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;string&#34;</span> });
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">tokenizer</span>.<span style="color:#a6e22e">add</span>(<span style="color:#e6db74">/`(?:[^`\\]|\\.)*`/</span>, { <span style="color:#a6e22e">tag</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;template&#34;</span> });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Comments
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">tokenizer</span>.<span style="color:#a6e22e">add</span>(<span style="color:#e6db74">/\/\/.*/</span>, { <span style="color:#a6e22e">tag</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;comment&#34;</span> });
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">tokenizer</span>.<span style="color:#a6e22e">add</span>(<span style="color:#e6db74">/\/\*[\s\S]*?\*\//</span>, { <span style="color:#a6e22e">tag</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;comment&#34;</span> });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Operators
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">tokenizer</span>.<span style="color:#a6e22e">add</span>(<span style="color:#e6db74">/[+\-*/%=&lt;&gt;!&amp;|^~?:]+/</span>, { <span style="color:#a6e22e">tag</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;operator&#34;</span> });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Punctuation
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">tokenizer</span>.<span style="color:#a6e22e">add</span>(<span style="color:#e6db74">/[{}()\[\];,.]/</span>, { <span style="color:#a6e22e">tag</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;punctuation&#34;</span> });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Identifiers
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">tokenizer</span>.<span style="color:#a6e22e">add</span>(<span style="color:#e6db74">/[a-zA-Z_$][a-zA-Z0-9_$]*/</span>, { <span style="color:#a6e22e">tag</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;identifier&#34;</span> });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Whitespace (skip)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">tokenizer</span>.<span style="color:#a6e22e">add</span>(<span style="color:#e6db74">/\s+/</span>, { <span style="color:#a6e22e">tag</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;whitespace&#34;</span>, <span style="color:#a6e22e">skip</span>: <span style="color:#66d9ef">true</span> });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">IncrementalTokenizer</span>(<span style="color:#a6e22e">tokenizer</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></code></pre><h3 id="step-2-initialize-on-document-load">Step 2: Initialize on Document Load <a class="anchor" href="#step-2-initialize-on-document-load">¶</a></h3>
<pre><code><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;"><code><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">incTokenizer</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">createJavaScriptTokenizer</span>();
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">documentText</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">editor</span>.<span style="color:#a6e22e">getValue</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Initial tokenization
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">tokens</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">incTokenizer</span>.<span style="color:#a6e22e">tokenize</span>(<span style="color:#a6e22e">documentText</span>);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">applyHighlighting</span>(<span style="color:#a6e22e">tokens</span>);
</span></span></code></pre></code></pre><h3 id="step-3-handle-edits">Step 3: Handle Edits <a class="anchor" href="#step-3-handle-edits">¶</a></h3>
<pre><code><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;"><code><span style="display:flex;"><span><span style="color:#a6e22e">editor</span>.<span style="color:#a6e22e">on</span>(<span style="color:#e6db74">&#34;change&#34;</span>, (<span style="color:#a6e22e">event</span>) <span style="color:#f92672">=&gt;</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">edit</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">start</span>: <span style="color:#66d9ef">event.start</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">end</span>: <span style="color:#66d9ef">event.end</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">newText</span>: <span style="color:#66d9ef">event.text</span>
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">documentText</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">editor</span>.<span style="color:#a6e22e">getValue</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">tokens</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">incTokenizer</span>.<span style="color:#a6e22e">update</span>(<span style="color:#a6e22e">documentText</span>, <span style="color:#a6e22e">edit</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">applyHighlighting</span>(<span style="color:#a6e22e">tokens</span>);
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></code></pre><hr />
<h2 id="real-time-character-by-character-updates">Real-Time Character-by-Character Updates <a class="anchor" href="#real-time-character-by-character-updates">¶</a></h2>
<p>For responsive typing, use the edit accumulator to batch rapid keystrokes:</p>
<pre><code><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;"><code><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">incTokenizer</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">createJavaScriptTokenizer</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Configure accumulation: flush after 10 edits or 16ms (one frame)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">incTokenizer</span>.<span style="color:#a6e22e">configureAccumulator</span>(
</span></span><span style="display:flex;"><span>  { <span style="color:#a6e22e">maxEdits</span>: <span style="color:#66d9ef">10</span>, <span style="color:#a6e22e">maxDelayMs</span>: <span style="color:#66d9ef">16</span> },
</span></span><span style="display:flex;"><span>  (<span style="color:#a6e22e">tokens</span>) <span style="color:#f92672">=&gt;</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">applyHighlighting</span>(<span style="color:#a6e22e">tokens</span>);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Initial tokenization
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">incTokenizer</span>.<span style="color:#a6e22e">tokenize</span>(<span style="color:#a6e22e">editor</span>.<span style="color:#a6e22e">getValue</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Handle each keystroke
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">editor</span>.<span style="color:#a6e22e">on</span>(<span style="color:#e6db74">&#34;input&#34;</span>, (<span style="color:#a6e22e">event</span>) <span style="color:#f92672">=&gt;</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">event</span>.<span style="color:#66d9ef">type</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#34;insert&#34;</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">incTokenizer</span>.<span style="color:#a6e22e">insertChar</span>(<span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">position</span>, <span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">char</span>);
</span></span><span style="display:flex;"><span>  } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">event</span>.<span style="color:#66d9ef">type</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#34;delete&#34;</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">incTokenizer</span>.<span style="color:#a6e22e">deleteChar</span>(<span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">position</span>);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Flush on blur or save
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">editor</span>.<span style="color:#a6e22e">on</span>(<span style="color:#e6db74">&#34;blur&#34;</span>, () <span style="color:#f92672">=&gt;</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">incTokenizer</span>.<span style="color:#a6e22e">flushAccumulatedEdits</span>();
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></code></pre><hr />
<h2 id="monaco-editor-integration">Monaco Editor Integration <a class="anchor" href="#monaco-editor-integration">¶</a></h2>
<pre><code><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;"><code><span style="display:flex;"><span><span style="color:#66d9ef">import</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">as</span> <span style="color:#a6e22e">monaco</span> <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#34;monaco-editor&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">Tokenizer</span>, <span style="color:#a6e22e">IncrementalTokenizer</span> } <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#34;tlex&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TLEXTokensProvider</span> <span style="color:#66d9ef">implements</span> <span style="color:#a6e22e">monaco</span>.<span style="color:#a6e22e">languages</span>.<span style="color:#a6e22e">TokensProvider</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">incTokenizer</span>: <span style="color:#66d9ef">IncrementalTokenizer</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">currentText</span>: <span style="color:#66d9ef">string</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">constructor</span>(<span style="color:#a6e22e">tokenizer</span>: <span style="color:#66d9ef">Tokenizer</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">incTokenizer</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">IncrementalTokenizer</span>(<span style="color:#a6e22e">tokenizer</span>);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">getInitialState</span>()<span style="color:#f92672">:</span> <span style="color:#a6e22e">monaco</span>.<span style="color:#a6e22e">languages</span>.<span style="color:#a6e22e">IState</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> { <span style="color:#a6e22e">clone</span><span style="color:#f92672">:</span> () <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">this</span>, <span style="color:#a6e22e">equals</span><span style="color:#f92672">:</span> () <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">true</span> };
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">tokenize</span>(<span style="color:#a6e22e">line</span>: <span style="color:#66d9ef">string</span>, <span style="color:#a6e22e">state</span>: <span style="color:#66d9ef">monaco.languages.IState</span>)<span style="color:#f92672">:</span> <span style="color:#a6e22e">monaco</span>.<span style="color:#a6e22e">languages</span>.<span style="color:#a6e22e">ILineTokens</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Monaco tokenizes line-by-line, but we can use TLEX for full document
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// This is a simplified approach - for best performance, track line boundaries
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">lineTokens</span>: <span style="color:#66d9ef">monaco.languages.IToken</span>[] <span style="color:#f92672">=</span> [];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">fullText</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">currentText</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">lineStart</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">fullText</span>.<span style="color:#a6e22e">indexOf</span>(<span style="color:#a6e22e">line</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">tokens</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">incTokenizer</span>.<span style="color:#a6e22e">getTokensInRange</span>(<span style="color:#a6e22e">lineStart</span>, <span style="color:#a6e22e">lineStart</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">line</span>.<span style="color:#a6e22e">length</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">token</span> <span style="color:#66d9ef">of</span> <span style="color:#a6e22e">tokens</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">startInLine</span> <span style="color:#f92672">=</span> Math.<span style="color:#a6e22e">max</span>(<span style="color:#ae81ff">0</span>, <span style="color:#a6e22e">token</span>.<span style="color:#a6e22e">start</span> <span style="color:#f92672">-</span> <span style="color:#a6e22e">lineStart</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">lineTokens</span>.<span style="color:#a6e22e">push</span>({
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">startIndex</span>: <span style="color:#66d9ef">startInLine</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">scopes</span>: <span style="color:#66d9ef">this.mapTagToScope</span>(<span style="color:#a6e22e">token</span>.<span style="color:#a6e22e">tag</span>)
</span></span><span style="display:flex;"><span>      });
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> { <span style="color:#a6e22e">tokens</span>: <span style="color:#66d9ef">lineTokens</span>, <span style="color:#a6e22e">endState</span>: <span style="color:#66d9ef">state</span> };
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">updateDocument</span>(<span style="color:#a6e22e">newText</span>: <span style="color:#66d9ef">string</span>, <span style="color:#a6e22e">edit</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">start</span>: <span style="color:#66d9ef">number</span>; <span style="color:#a6e22e">end</span>: <span style="color:#66d9ef">number</span>; <span style="color:#a6e22e">newText</span>: <span style="color:#66d9ef">string</span> }) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">currentText</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">newText</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">incTokenizer</span>.<span style="color:#a6e22e">update</span>(<span style="color:#a6e22e">newText</span>, <span style="color:#a6e22e">edit</span>);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">mapTagToScope</span>(<span style="color:#a6e22e">tag</span>: <span style="color:#66d9ef">string</span>)<span style="color:#f92672">:</span> <span style="color:#66d9ef">string</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">scopeMap</span>: <span style="color:#66d9ef">Record</span>&lt;<span style="color:#f92672">string</span><span style="color:#960050;background-color:#1e0010">,</span> <span style="color:#a6e22e">string</span>&gt; <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">keyword</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;keyword&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">builtin</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;constant.language&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">number</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;constant.numeric&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">string</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;string&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">template</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;string.template&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">comment</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;comment&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">operator</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;keyword.operator&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">punctuation</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;punctuation&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">identifier</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;variable&#34;</span>
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">scopeMap</span>[<span style="color:#a6e22e">tag</span>] <span style="color:#f92672">||</span> <span style="color:#e6db74">&#34;source&#34;</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Register language
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">monaco</span>.<span style="color:#a6e22e">languages</span>.<span style="color:#a6e22e">register</span>({ <span style="color:#a6e22e">id</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;mylang&#34;</span> });
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">monaco</span>.<span style="color:#a6e22e">languages</span>.<span style="color:#a6e22e">setTokensProvider</span>(<span style="color:#e6db74">&#34;mylang&#34;</span>, <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">TLEXTokensProvider</span>(<span style="color:#a6e22e">createTokenizer</span>()));
</span></span></code></pre></code></pre><hr />
<h2 id="codemirror-6-integration">CodeMirror 6 Integration <a class="anchor" href="#codemirror-6-integration">¶</a></h2>
<pre><code><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;"><code><span style="display:flex;"><span><span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">EditorView</span>, <span style="color:#a6e22e">ViewPlugin</span>, <span style="color:#a6e22e">Decoration</span>, <span style="color:#a6e22e">DecorationSet</span> } <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#34;@codemirror/view&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">RangeSetBuilder</span> } <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#34;@codemirror/state&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">Tokenizer</span>, <span style="color:#a6e22e">IncrementalTokenizer</span>, <span style="color:#a6e22e">Token</span> } <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#34;tlex&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">tlexHighlighter</span>(<span style="color:#a6e22e">tokenizer</span>: <span style="color:#66d9ef">Tokenizer</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">incTokenizer</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">IncrementalTokenizer</span>(<span style="color:#a6e22e">tokenizer</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">ViewPlugin</span>.<span style="color:#a6e22e">fromClass</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">class</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">decorations</span>: <span style="color:#66d9ef">DecorationSet</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">constructor</span>(<span style="color:#a6e22e">view</span>: <span style="color:#66d9ef">EditorView</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">text</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">view</span>.<span style="color:#a6e22e">state</span>.<span style="color:#a6e22e">doc</span>.<span style="color:#a6e22e">toString</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">tokens</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">incTokenizer</span>.<span style="color:#a6e22e">tokenize</span>(<span style="color:#a6e22e">text</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">decorations</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">buildDecorations</span>(<span style="color:#a6e22e">tokens</span>);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">update</span>(<span style="color:#a6e22e">update</span>: <span style="color:#66d9ef">any</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">update</span>.<span style="color:#a6e22e">docChanged</span>) {
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">newText</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">update</span>.<span style="color:#a6e22e">state</span>.<span style="color:#a6e22e">doc</span>.<span style="color:#a6e22e">toString</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">// Convert CodeMirror changes to EditRange
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>          <span style="color:#a6e22e">update</span>.<span style="color:#a6e22e">changes</span>.<span style="color:#a6e22e">iterChanges</span>((<span style="color:#a6e22e">fromA</span>: <span style="color:#66d9ef">number</span>, <span style="color:#a6e22e">toA</span>: <span style="color:#66d9ef">number</span>, <span style="color:#a6e22e">fromB</span>: <span style="color:#66d9ef">number</span>, <span style="color:#a6e22e">toB</span>: <span style="color:#66d9ef">number</span>, <span style="color:#a6e22e">inserted</span>: <span style="color:#66d9ef">any</span>) <span style="color:#f92672">=&gt;</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">incTokenizer</span>.<span style="color:#a6e22e">update</span>(<span style="color:#a6e22e">newText</span>, {
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">start</span>: <span style="color:#66d9ef">fromA</span>,
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">end</span>: <span style="color:#66d9ef">toA</span>,
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">newText</span>: <span style="color:#66d9ef">inserted.toString</span>()
</span></span><span style="display:flex;"><span>            });
</span></span><span style="display:flex;"><span>          });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">tokens</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">incTokenizer</span>.<span style="color:#a6e22e">getTokens</span>();
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">decorations</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">buildDecorations</span>(<span style="color:#a6e22e">tokens</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">buildDecorations</span>(<span style="color:#a6e22e">tokens</span>: <span style="color:#66d9ef">Token</span>[])<span style="color:#f92672">:</span> <span style="color:#a6e22e">DecorationSet</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">builder</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">RangeSetBuilder</span>&lt;<span style="color:#f92672">Decoration</span>&gt;();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">token</span> <span style="color:#66d9ef">of</span> <span style="color:#a6e22e">tokens</span>) {
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">decoration</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Decoration</span>.<span style="color:#a6e22e">mark</span>({
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">class</span><span style="color:#f92672">:</span> <span style="color:#e6db74">`tok-</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">token</span>.<span style="color:#a6e22e">tag</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>
</span></span><span style="display:flex;"><span>          });
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">builder</span>.<span style="color:#a6e22e">add</span>(<span style="color:#a6e22e">token</span>.<span style="color:#a6e22e">start</span>, <span style="color:#a6e22e">token</span>.<span style="color:#a6e22e">end</span>, <span style="color:#a6e22e">decoration</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">builder</span>.<span style="color:#a6e22e">finish</span>();
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    { <span style="color:#a6e22e">decorations</span><span style="color:#f92672">:</span> (<span style="color:#a6e22e">v</span>) <span style="color:#f92672">=&gt;</span> <span style="color:#a6e22e">v</span>.<span style="color:#a6e22e">decorations</span> }
</span></span><span style="display:flex;"><span>  );
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Usage
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">view</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">EditorView</span>({
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">extensions</span><span style="color:#f92672">:</span> [<span style="color:#a6e22e">tlexHighlighter</span>(<span style="color:#a6e22e">createTokenizer</span>())],
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">parent</span>: <span style="color:#66d9ef">document.querySelector</span>(<span style="color:#e6db74">&#34;#editor&#34;</span>)<span style="color:#f92672">!</span>
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></code></pre><hr />
<h2 id="ace-editor-integration">Ace Editor Integration <a class="anchor" href="#ace-editor-integration">¶</a></h2>
<pre><code><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;"><code><span style="display:flex;"><span><span style="color:#66d9ef">import</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">as</span> <span style="color:#a6e22e">ace</span> <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#34;ace-builds&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">Tokenizer</span>, <span style="color:#a6e22e">IncrementalTokenizer</span>, <span style="color:#a6e22e">Token</span> } <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#34;tlex&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TLEXHighlightRules</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">ace</span>.<span style="color:#66d9ef">require</span>(<span style="color:#e6db74">&#34;ace/mode/text_highlight_rules&#34;</span>).<span style="color:#a6e22e">TextHighlightRules</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">incTokenizer</span>: <span style="color:#66d9ef">IncrementalTokenizer</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">constructor</span>(<span style="color:#a6e22e">tokenizer</span>: <span style="color:#66d9ef">Tokenizer</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">super</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">incTokenizer</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">IncrementalTokenizer</span>(<span style="color:#a6e22e">tokenizer</span>);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">getTokens</span>(<span style="color:#a6e22e">text</span>: <span style="color:#66d9ef">string</span>)<span style="color:#f92672">:</span> <span style="color:#a6e22e">Token</span>[] {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">incTokenizer</span>.<span style="color:#a6e22e">tokenize</span>(<span style="color:#a6e22e">text</span>);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TLEXMode</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">ace</span>.<span style="color:#66d9ef">require</span>(<span style="color:#e6db74">&#34;ace/mode/text&#34;</span>).<span style="color:#a6e22e">Mode</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">incTokenizer</span>: <span style="color:#66d9ef">IncrementalTokenizer</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">constructor</span>(<span style="color:#a6e22e">tokenizer</span>: <span style="color:#66d9ef">Tokenizer</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">super</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">incTokenizer</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">IncrementalTokenizer</span>(<span style="color:#a6e22e">tokenizer</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">$id</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;ace/mode/tlex&#34;</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Override getTokenizer to use TLEX
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">getTokenizer() {</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">getLineTokens</span><span style="color:#f92672">:</span> (<span style="color:#a6e22e">line</span>: <span style="color:#66d9ef">string</span>, <span style="color:#a6e22e">state</span>: <span style="color:#66d9ef">string</span>, <span style="color:#a6e22e">row</span>: <span style="color:#66d9ef">number</span>) <span style="color:#f92672">=&gt;</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Ace is line-based - for best results, maintain full document context
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">tokens</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">incTokenizer</span>.<span style="color:#a6e22e">getTokensInRange</span>(<span style="color:#ae81ff">0</span>, <span style="color:#a6e22e">line</span>.<span style="color:#a6e22e">length</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> {
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">tokens</span>: <span style="color:#66d9ef">tokens.map</span>((<span style="color:#a6e22e">t</span>) <span style="color:#f92672">=&gt;</span> ({
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">type</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">mapTagToAceType</span>(<span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">tag</span>),
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">value</span>: <span style="color:#66d9ef">t.value</span>
</span></span><span style="display:flex;"><span>          })),
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">state</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;start&#34;</span>
</span></span><span style="display:flex;"><span>        };
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">mapTagToAceType</span>(<span style="color:#a6e22e">tag</span>: <span style="color:#66d9ef">string</span>)<span style="color:#f92672">:</span> <span style="color:#66d9ef">string</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">typeMap</span>: <span style="color:#66d9ef">Record</span>&lt;<span style="color:#f92672">string</span><span style="color:#960050;background-color:#1e0010">,</span> <span style="color:#a6e22e">string</span>&gt; <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">keyword</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;keyword&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">builtin</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;constant.language&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">number</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;constant.numeric&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">string</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;string&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">comment</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;comment&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">operator</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;keyword.operator&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">identifier</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;identifier&#34;</span>
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">typeMap</span>[<span style="color:#a6e22e">tag</span>] <span style="color:#f92672">||</span> <span style="color:#e6db74">&#34;text&#34;</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></code></pre><hr />
<h2 id="applying-highlighting">Applying Highlighting <a class="anchor" href="#applying-highlighting">¶</a></h2>
<h3 id="dom-based-highlighting">DOM-Based Highlighting <a class="anchor" href="#dom-based-highlighting">¶</a></h3>
<pre><code><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;"><code><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">applyHighlighting</span>(<span style="color:#a6e22e">tokens</span>: <span style="color:#66d9ef">Token</span>[], <span style="color:#a6e22e">container</span>: <span style="color:#66d9ef">HTMLElement</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Clear existing
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">container</span>.<span style="color:#a6e22e">innerHTML</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">text</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">incTokenizer</span>.<span style="color:#a6e22e">getInput</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">token</span> <span style="color:#66d9ef">of</span> <span style="color:#a6e22e">tokens</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">span</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">createElement</span>(<span style="color:#e6db74">&#34;span&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">span</span>.<span style="color:#a6e22e">className</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">`token-</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">token</span>.<span style="color:#a6e22e">tag</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">span</span>.<span style="color:#a6e22e">textContent</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">text</span>.<span style="color:#a6e22e">slice</span>(<span style="color:#a6e22e">token</span>.<span style="color:#a6e22e">start</span>, <span style="color:#a6e22e">token</span>.<span style="color:#a6e22e">end</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">container</span>.<span style="color:#a6e22e">appendChild</span>(<span style="color:#a6e22e">span</span>);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></code></pre><h3 id="range-based-highlighting-for-contenteditable">Range-Based Highlighting (for contenteditable) <a class="anchor" href="#range-based-highlighting-for-contenteditable">¶</a></h3>
<pre><code><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;"><code><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">highlightRange</span>(<span style="color:#a6e22e">tokens</span>: <span style="color:#66d9ef">Token</span>[], <span style="color:#a6e22e">rootNode</span>: <span style="color:#66d9ef">Node</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Clear existing highlights
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">existingHighlights</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">querySelectorAll</span>(<span style="color:#e6db74">&#34;.syntax-highlight&#34;</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">existingHighlights</span>.<span style="color:#a6e22e">forEach</span>((<span style="color:#a6e22e">el</span>) <span style="color:#f92672">=&gt;</span> <span style="color:#a6e22e">el</span>.<span style="color:#a6e22e">remove</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">text</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">incTokenizer</span>.<span style="color:#a6e22e">getInput</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">range</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">createRange</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">token</span> <span style="color:#66d9ef">of</span> <span style="color:#a6e22e">tokens</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Create highlight overlay
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">highlight</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">createElement</span>(<span style="color:#e6db74">&#34;span&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">highlight</span>.<span style="color:#a6e22e">className</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">`syntax-highlight token-</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">token</span>.<span style="color:#a6e22e">tag</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Position the highlight
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">textNode</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">findTextNodeAt</span>(<span style="color:#a6e22e">rootNode</span>, <span style="color:#a6e22e">token</span>.<span style="color:#a6e22e">start</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">textNode</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">range</span>.<span style="color:#a6e22e">setStart</span>(<span style="color:#a6e22e">textNode</span>.<span style="color:#a6e22e">node</span>, <span style="color:#a6e22e">textNode</span>.<span style="color:#a6e22e">offset</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">range</span>.<span style="color:#a6e22e">setEnd</span>(<span style="color:#a6e22e">textNode</span>.<span style="color:#a6e22e">node</span>, <span style="color:#a6e22e">textNode</span>.<span style="color:#a6e22e">offset</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">token</span>.<span style="color:#a6e22e">value</span>.<span style="color:#a6e22e">length</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">rect</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">range</span>.<span style="color:#a6e22e">getBoundingClientRect</span>();
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">highlight</span>.<span style="color:#a6e22e">style</span>.<span style="color:#a6e22e">left</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">`</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">rect</span>.<span style="color:#a6e22e">left</span><span style="color:#e6db74">}</span><span style="color:#e6db74">px`</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">highlight</span>.<span style="color:#a6e22e">style</span>.<span style="color:#a6e22e">top</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">`</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">rect</span>.<span style="color:#a6e22e">top</span><span style="color:#e6db74">}</span><span style="color:#e6db74">px`</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">highlight</span>.<span style="color:#a6e22e">style</span>.<span style="color:#a6e22e">width</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">`</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">rect</span>.<span style="color:#a6e22e">width</span><span style="color:#e6db74">}</span><span style="color:#e6db74">px`</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">highlight</span>.<span style="color:#a6e22e">style</span>.<span style="color:#a6e22e">height</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">`</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">rect</span>.<span style="color:#a6e22e">height</span><span style="color:#e6db74">}</span><span style="color:#e6db74">px`</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      document.<span style="color:#a6e22e">body</span>.<span style="color:#a6e22e">appendChild</span>(<span style="color:#a6e22e">highlight</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></code></pre><hr />
<h2 id="css-token-styles">CSS Token Styles <a class="anchor" href="#css-token-styles">¶</a></h2>
<pre><code><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;"><code><span style="display:flex;"><span><span style="color:#75715e">/* Base token styles */</span>
</span></span><span style="display:flex;"><span>.<span style="color:#a6e22e">token-keyword</span> { <span style="color:#66d9ef">color</span>: <span style="color:#ae81ff">#c678dd</span>; <span style="color:#66d9ef">font-weight</span>: <span style="color:#ae81ff">500</span>; }
</span></span><span style="display:flex;"><span>.<span style="color:#a6e22e">token-builtin</span> { <span style="color:#66d9ef">color</span>: <span style="color:#ae81ff">#e5c07b</span>; }
</span></span><span style="display:flex;"><span>.<span style="color:#a6e22e">token-number</span> { <span style="color:#66d9ef">color</span>: <span style="color:#ae81ff">#d19a66</span>; }
</span></span><span style="display:flex;"><span>.<span style="color:#a6e22e">token-string</span> { <span style="color:#66d9ef">color</span>: <span style="color:#ae81ff">#98c379</span>; }
</span></span><span style="display:flex;"><span>.<span style="color:#a6e22e">token-template</span> { <span style="color:#66d9ef">color</span>: <span style="color:#ae81ff">#98c379</span>; }
</span></span><span style="display:flex;"><span>.<span style="color:#a6e22e">token-comment</span> { <span style="color:#66d9ef">color</span>: <span style="color:#ae81ff">#5c6370</span>; <span style="color:#66d9ef">font-style</span>: <span style="color:#66d9ef">italic</span>; }
</span></span><span style="display:flex;"><span>.<span style="color:#a6e22e">token-operator</span> { <span style="color:#66d9ef">color</span>: <span style="color:#ae81ff">#56b6c2</span>; }
</span></span><span style="display:flex;"><span>.<span style="color:#a6e22e">token-punctuation</span> { <span style="color:#66d9ef">color</span>: <span style="color:#ae81ff">#abb2bf</span>; }
</span></span><span style="display:flex;"><span>.<span style="color:#a6e22e">token-identifier</span> { <span style="color:#66d9ef">color</span>: <span style="color:#ae81ff">#61afef</span>; }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/* Dark theme overrides */</span>
</span></span><span style="display:flex;"><span>.<span style="color:#a6e22e">dark</span> .<span style="color:#a6e22e">token-keyword</span> { <span style="color:#66d9ef">color</span>: <span style="color:#ae81ff">#c678dd</span>; }
</span></span><span style="display:flex;"><span>.<span style="color:#a6e22e">dark</span> .<span style="color:#a6e22e">token-string</span> { <span style="color:#66d9ef">color</span>: <span style="color:#ae81ff">#98c379</span>; }
</span></span><span style="display:flex;"><span><span style="color:#75715e">/* ... */</span>
</span></span></code></pre></code></pre><hr />
<h2 id="performance-tips">Performance Tips <a class="anchor" href="#performance-tips">¶</a></h2>
<h3 id="1-debounce-large-edits">1. Debounce Large Edits <a class="anchor" href="#1-debounce-large-edits">¶</a></h3>
<p>For operations like paste, debounce the tokenization:</p>
<pre><code><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;"><code><span style="display:flex;"><span><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">debounceTimer</span>: <span style="color:#66d9ef">ReturnType</span>&lt;<span style="color:#f92672">typeof</span> <span style="color:#a6e22e">setTimeout</span>&gt;;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">editor</span>.<span style="color:#a6e22e">on</span>(<span style="color:#e6db74">&#34;change&#34;</span>, (<span style="color:#a6e22e">event</span>) <span style="color:#f92672">=&gt;</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">clearTimeout</span>(<span style="color:#a6e22e">debounceTimer</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">text</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">100</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Large paste - debounce
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">debounceTimer</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">setTimeout</span>(() <span style="color:#f92672">=&gt;</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">updateTokens</span>(<span style="color:#a6e22e">event</span>);
</span></span><span style="display:flex;"><span>    }, <span style="color:#ae81ff">50</span>);
</span></span><span style="display:flex;"><span>  } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Small edit - immediate
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">updateTokens</span>(<span style="color:#a6e22e">event</span>);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></code></pre><h3 id="2-virtualize-token-rendering">2. Virtualize Token Rendering <a class="anchor" href="#2-virtualize-token-rendering">¶</a></h3>
<p>For large files, only render visible tokens:</p>
<pre><code><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;"><code><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">renderVisibleTokens</span>(
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">tokens</span>: <span style="color:#66d9ef">Token</span>[],
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">viewStart</span>: <span style="color:#66d9ef">number</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">viewEnd</span>: <span style="color:#66d9ef">number</span>
</span></span><span style="display:flex;"><span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">visibleTokens</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">incTokenizer</span>.<span style="color:#a6e22e">getTokensInRange</span>(<span style="color:#a6e22e">viewStart</span>, <span style="color:#a6e22e">viewEnd</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Only render these tokens
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span></code></pre></code></pre><h3 id="3-use-requestanimationframe">3. Use requestAnimationFrame <a class="anchor" href="#3-use-requestanimationframe">¶</a></h3>
<pre><code><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;"><code><span style="display:flex;"><span><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">pendingRender</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">scheduleRender</span>(<span style="color:#a6e22e">tokens</span>: <span style="color:#66d9ef">Token</span>[]) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">pendingRender</span>) <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">pendingRender</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">requestAnimationFrame</span>(() <span style="color:#f92672">=&gt;</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">applyHighlighting</span>(<span style="color:#a6e22e">tokens</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">pendingRender</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></code></pre><h3 id="4-web-worker-for-initial-parse">4. Web Worker for Initial Parse <a class="anchor" href="#4-web-worker-for-initial-parse">¶</a></h3>
<p>For very large files, perform initial tokenization in a worker:</p>
<pre><code><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;"><code><span style="display:flex;"><span><span style="color:#75715e">// worker.ts
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">Tokenizer</span>, <span style="color:#a6e22e">IncrementalTokenizer</span> } <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#34;tlex&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">incTokenizer</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">createTokenizer</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">self</span>.<span style="color:#a6e22e">onmessage</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">event</span>) <span style="color:#f92672">=&gt;</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> { <span style="color:#66d9ef">type</span>, <span style="color:#a6e22e">text</span>, <span style="color:#a6e22e">edit</span> } <span style="color:#f92672">=</span> <span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">data</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">type</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#34;tokenize&#34;</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">tokens</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">incTokenizer</span>.<span style="color:#a6e22e">tokenize</span>(<span style="color:#a6e22e">text</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">self</span>.<span style="color:#a6e22e">postMessage</span>({ <span style="color:#a6e22e">tokens</span> });
</span></span><span style="display:flex;"><span>  } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">type</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#34;update&#34;</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">tokens</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">incTokenizer</span>.<span style="color:#a6e22e">update</span>(<span style="color:#a6e22e">text</span>, <span style="color:#a6e22e">edit</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">self</span>.<span style="color:#a6e22e">postMessage</span>({ <span style="color:#a6e22e">tokens</span> });
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// main.ts
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">worker</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Worker</span>(<span style="color:#e6db74">&#34;worker.ts&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">worker</span>.<span style="color:#a6e22e">postMessage</span>({ <span style="color:#66d9ef">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;tokenize&#34;</span>, <span style="color:#a6e22e">text</span>: <span style="color:#66d9ef">largeDocument</span> });
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">worker</span>.<span style="color:#a6e22e">onmessage</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">event</span>) <span style="color:#f92672">=&gt;</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">applyHighlighting</span>(<span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">tokens</span>);
</span></span><span style="display:flex;"><span>};
</span></span></code></pre></code></pre><hr />
<h2 id="testing-your-integration">Testing Your Integration <a class="anchor" href="#testing-your-integration">¶</a></h2>
<pre><code><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;"><code><span style="display:flex;"><span><span style="color:#a6e22e">describe</span>(<span style="color:#e6db74">&#34;Editor Integration&#34;</span>, () <span style="color:#f92672">=&gt;</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">it</span>(<span style="color:#e6db74">&#34;handles rapid typing&#34;</span>, <span style="color:#66d9ef">async</span> () <span style="color:#f92672">=&gt;</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">incTokenizer</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">createJavaScriptTokenizer</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">incTokenizer</span>.<span style="color:#a6e22e">configureAccumulator</span>({ <span style="color:#a6e22e">maxEdits</span>: <span style="color:#66d9ef">5</span>, <span style="color:#a6e22e">maxDelayMs</span>: <span style="color:#66d9ef">10</span> }, () <span style="color:#f92672">=&gt;</span> {});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">incTokenizer</span>.<span style="color:#a6e22e">tokenize</span>(<span style="color:#e6db74">&#34;&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Simulate typing &#34;const&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">incTokenizer</span>.<span style="color:#a6e22e">insertChar</span>(<span style="color:#ae81ff">0</span>, <span style="color:#e6db74">&#34;c&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">incTokenizer</span>.<span style="color:#a6e22e">insertChar</span>(<span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#34;o&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">incTokenizer</span>.<span style="color:#a6e22e">insertChar</span>(<span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&#34;n&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">incTokenizer</span>.<span style="color:#a6e22e">insertChar</span>(<span style="color:#ae81ff">3</span>, <span style="color:#e6db74">&#34;s&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">incTokenizer</span>.<span style="color:#a6e22e">insertChar</span>(<span style="color:#ae81ff">4</span>, <span style="color:#e6db74">&#34;t&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">tokens</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">incTokenizer</span>.<span style="color:#a6e22e">flushAccumulatedEdits</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">expect</span>(<span style="color:#a6e22e">tokens</span>[<span style="color:#ae81ff">0</span>].<span style="color:#a6e22e">tag</span>).<span style="color:#a6e22e">toBe</span>(<span style="color:#e6db74">&#34;keyword&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">expect</span>(<span style="color:#a6e22e">tokens</span>[<span style="color:#ae81ff">0</span>].<span style="color:#a6e22e">value</span>).<span style="color:#a6e22e">toBe</span>(<span style="color:#e6db74">&#34;const&#34;</span>);
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">it</span>(<span style="color:#e6db74">&#34;maintains consistency after edits&#34;</span>, () <span style="color:#f92672">=&gt;</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">incTokenizer</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">createJavaScriptTokenizer</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Full tokenization
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">initial</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">incTokenizer</span>.<span style="color:#a6e22e">tokenize</span>(<span style="color:#e6db74">&#34;const x = 1;&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Edit in middle
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">updated</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">incTokenizer</span>.<span style="color:#a6e22e">update</span>(<span style="color:#e6db74">&#34;const xy = 1;&#34;</span>, {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">start</span>: <span style="color:#66d9ef">7</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">end</span>: <span style="color:#66d9ef">7</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">newText</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;y&#34;</span>
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Re-tokenize from scratch for comparison
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">fresh</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">IncrementalTokenizer</span>(<span style="color:#a6e22e">createTokenizer</span>());
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">expected</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">fresh</span>.<span style="color:#a6e22e">tokenize</span>(<span style="color:#e6db74">&#34;const xy = 1;&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Should produce identical results
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">expect</span>(<span style="color:#a6e22e">updated</span>.<span style="color:#a6e22e">map</span>((<span style="color:#a6e22e">t</span>) <span style="color:#f92672">=&gt;</span> <span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">tag</span>)).<span style="color:#a6e22e">toEqual</span>(<span style="color:#a6e22e">expected</span>.<span style="color:#a6e22e">map</span>((<span style="color:#a6e22e">t</span>) <span style="color:#f92672">=&gt;</span> <span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">tag</span>));
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">expect</span>(<span style="color:#a6e22e">updated</span>.<span style="color:#a6e22e">map</span>((<span style="color:#a6e22e">t</span>) <span style="color:#f92672">=&gt;</span> <span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">value</span>)).<span style="color:#a6e22e">toEqual</span>(<span style="color:#a6e22e">expected</span>.<span style="color:#a6e22e">map</span>((<span style="color:#a6e22e">t</span>) <span style="color:#f92672">=&gt;</span> <span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">value</span>));
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></code></pre><hr />
<h2 id="see-also">See Also <a class="anchor" href="#see-also">¶</a></h2>
<ul>
<li><a href="/tlex/reference/incremental-tokenizer/">IncrementalTokenizer API</a> - Full API reference</li>
<li><a href="/tlex/playground/">Playground</a> - Interactive demo with comparison view</li>
<li><a href="/tlex/examples/">Examples</a> - Complete tokenizer examples</li>
</ul>

        
    </div>

    
    
</article>

        </main>
    </div>
    

    
    
    
<footer class="site-footer">
    <div class="footer-container">
        <div class="footer-section">
            <h4>TLEX</h4>
            <p>A powerful lexer generator and tokenizer library for TypeScript</p>
            <p class="version">Version 1.0.0</p>
        </div>

        <div class="footer-section">
            <h4>Quick Links</h4>
            <ul>
                <li><a href="/tlex/getting-started/">Getting Started</a></li>
                <li><a href="/tlex/concepts/">Concepts</a></li>
                <li><a href="/tlex/reference/">Reference</a></li>
                <li><a href="/tlex/examples/">Examples</a></li>
            </ul>
        </div>

        <div class="footer-section">
            <h4>Community</h4>
            <ul>
                <li><a href="https://github.com/panyam/tlex" target="_blank" rel="noopener">GitHub Repository</a></li>
                <li><a href="https://github.com/panyam/tlex/issues" target="_blank" rel="noopener">Report Issues</a></li>
                <li><a href="https://www.npmjs.com/package/tlex" target="_blank" rel="noopener">npm Package</a></li>
            </ul>
        </div>

        <div class="footer-section">
            <h4>License</h4>
            <p>Licensed under <a href="https://github.com/panyam/tlex/blob/master/LICENSE">MIT</a></p>
            <p>&copy;  Sriram Panyam</p>
        </div>
    </div>

    <div class="footer-bottom">
        <p>Built with <a href="https://github.com/panyam/s3gen" target="_blank">s3gen</a></p>
    </div>
</footer>

    

    
    
    <script defer="defer" src="/tlex/static/js/gen/59.53f8ed6f679c11016011.js"></script>
<script defer="defer" src="/tlex/static/js/gen/513.f5749b8d6a5fba145786.js"></script>
<script defer="defer" src="/tlex/static/js/gen/DocsPage.c50725eb494e4eb17a75.js"></script>
    

    
    <script>
        (function() {
            var toggle = document.getElementById('theme-toggle');
            if (toggle) {
                toggle.addEventListener('click', function() {
                    var isDark = document.documentElement.classList.toggle('dark');
                    localStorage.setItem('theme', isDark ? 'dark' : 'light');
                });
            }
        })();
    </script>
</body>
</html>
