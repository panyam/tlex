<!DOCTYPE html>









<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="State-based tokenization">
    <title>Tokenizer States - TLEX</title>

    
    <script>
        (function() {
            var theme = localStorage.getItem('theme');
            if (theme === 'dark' || (!theme && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                document.documentElement.classList.add('dark');
            }
        })();
    </script>

    
    <link rel="stylesheet" href="/tlex/static/css/tsappkit-docs.css">
    <link rel="stylesheet" href="/tlex/static/css/main.css">
    

    
    <link rel="icon" type="image/png" href="/tlex/static/images/favicon.png">
</head>
<body class="">
    
    
<header class="site-header">
    <div class="header-container">
        
        <div class="logo">
            <a href="/tlex/">
                <span class="logo-text">TLEX</span>
            </a>
        </div>

        <nav class="main-nav">
            
            
            <div class="nav-item">
                <a href="/tlex/getting-started/" class="nav-link">
                    
                    Getting Started
                </a>
                
            </div>
            
            <div class="nav-item">
                <a href="/tlex/playground/" class="nav-link">
                    
                    Playground
                </a>
                
            </div>
            
            <div class="nav-item has-children">
                <a href="/tlex/concepts/" class="nav-link">
                    
                    Concepts
                </a>
                
                <div class="nav-dropdown">
                    
                    <a href="/tlex/concepts/regex-ast/" class="dropdown-item">Regex AST</a>
                    
                    <a href="/tlex/concepts/vm-architecture/" class="dropdown-item">VM Architecture</a>
                    
                </div>
                
            </div>
            
            <div class="nav-item has-children">
                <a href="/tlex/reference/" class="nav-link">
                    
                    Reference
                </a>
                
                <div class="nav-dropdown">
                    
                    <a href="/tlex/reference/api/" class="dropdown-item">API Reference</a>
                    
                    <a href="/tlex/reference/incremental-tokenizer/" class="dropdown-item">Incremental Tokenizer</a>
                    
                    <a href="/tlex/reference/js-regex-syntax/" class="dropdown-item">JavaScript Regex</a>
                    
                    <a href="/tlex/reference/flex-syntax/" class="dropdown-item">Flex Syntax</a>
                    
                    <a href="/tlex/reference/rule-config/" class="dropdown-item">Rule Config</a>
                    
                    <a href="/tlex/reference/tokenizer-states/" class="dropdown-item">Tokenizer States</a>
                    
                </div>
                
            </div>
            
            <div class="nav-item has-children">
                <a href="/tlex/guides/" class="nav-link">
                    
                    Guides
                </a>
                
                <div class="nav-dropdown">
                    
                    <a href="/tlex/guides/editor-integration/" class="dropdown-item">Editor Integration</a>
                    
                </div>
                
            </div>
            
            <div class="nav-item has-children">
                <a href="/tlex/examples/" class="nav-link">
                    
                    Examples
                </a>
                
                <div class="nav-dropdown">
                    
                    <a href="/tlex/examples/json-tokenizer/" class="dropdown-item">JSON Tokenizer</a>
                    
                    <a href="/tlex/examples/calculator/" class="dropdown-item">Calculator</a>
                    
                    <a href="/tlex/examples/c-lexer/" class="dropdown-item">C Lexer</a>
                    
                </div>
                
            </div>
            
        </nav>

        <div class="header-actions">
            <button class="theme-toggle" id="theme-toggle" aria-label="Toggle dark mode" title="Toggle dark mode">
                
                <svg class="icon-sun" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
                </svg>
                
                <svg class="icon-moon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
                </svg>
            </button>
            <a href="https://github.com/panyam/tlex" class="btn-github" target="_blank" rel="noopener">
                GitHub
            </a>
        </div>
    </div>
</header>


    
    <div class="page-container">
        
        
<aside class="sidebar">
    <div class="sidebar-content">
        

        
        <nav class="section-nav">
            
            <div class="section-nav-content">
                <h3>Reference</h3>
                <ul>
                    <li><a href="/tlex/reference/">Overview</a></li>
                    <li><a href="/tlex/reference/api/">API Reference</a></li>
                    <li><a href="/tlex/reference/incremental-tokenizer/">Incremental Tokenizer</a></li>
                    <li><a href="/tlex/reference/js-regex-syntax/">JavaScript Regex</a></li>
                    <li><a href="/tlex/reference/flex-syntax/">Flex Syntax</a></li>
                    <li><a href="/tlex/reference/rule-config/">Rule Configuration</a></li>
                    <li><a href="/tlex/reference/tokenizer-states/">Tokenizer States</a></li>
                </ul>
            </div>
            
        </nav>
    </div>
</aside>


        
        <main class="main-content">
            
<article class="content">
    
    
    <header class="content-header">
        <h1>Tokenizer States</h1>
        
        <p class="lead">State-based tokenization</p>
        
    </header>
    

    
    <div class="content-body">
        
            
            
            <h2 id="overview">Overview <a class="anchor" href="#overview">¶</a></h2>
<p>Tokenizer states enable context-sensitive tokenization, similar to Flex start conditions. Rules can be restricted to only match in specific states, allowing you to handle constructs like string literals, comments, and nested structures where the same character sequence has different meanings in different contexts.</p>
<h2 id="the-activestates-option">The activeStates Option <a class="anchor" href="#the-activestates-option">¶</a></h2>
<p>Use the <code>activeStates</code> option to restrict a rule to specific states:</p>
<pre><code><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;"><code><span style="display:flex;"><span><span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">Tokenizer</span> } <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#34;tlex&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">tokenizer</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Tokenizer</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Rules without activeStates match in all states (including INITIAL)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">tokenizer</span>.<span style="color:#a6e22e">add</span>(<span style="color:#e6db74">/[a-z]+/</span>, { <span style="color:#a6e22e">tag</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;IDENTIFIER&#34;</span> });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Rule only matches in STRING state
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">tokenizer</span>.<span style="color:#a6e22e">add</span>(<span style="color:#e6db74">/[^&#34;\\]+/</span>, {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">tag</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;STRING_CONTENT&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">activeStates</span>: <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Set</span>([<span style="color:#e6db74">&#34;STRING&#34;</span>])
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Rule matches in multiple states
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">tokenizer</span>.<span style="color:#a6e22e">add</span>(<span style="color:#e6db74">/\n/</span>, {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">tag</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;NEWLINE&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">activeStates</span>: <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Set</span>([<span style="color:#e6db74">&#34;INITIAL&#34;</span>, <span style="color:#e6db74">&#34;COMMENT&#34;</span>])
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Wildcard &#34;*&#34; matches all states (same as no activeStates)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">tokenizer</span>.<span style="color:#a6e22e">add</span>(<span style="color:#e6db74">/\s+/</span>, {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">tag</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;WHITESPACE&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">skip</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">activeStates</span>: <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Set</span>([<span style="color:#e6db74">&#34;*&#34;</span>])
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></code></pre><h2 id="state-matching-rules">State Matching Rules <a class="anchor" href="#state-matching-rules">¶</a></h2>
<ol>
<li><strong>No activeStates</strong> - Rule matches in all states</li>
<li><strong>Empty Set</strong> - Rule matches in all states</li>
<li><strong>Set with &ldquo;*&rdquo;</strong> - Rule matches in all states (explicit wildcard)</li>
<li><strong>Set with state names</strong> - Rule only matches when current state is in the set</li>
</ol>
<pre><code><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;"><code><span style="display:flex;"><span><span style="color:#75715e">// These are equivalent - all match in any state
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">tokenizer</span>.<span style="color:#a6e22e">add</span>(<span style="color:#e6db74">/pattern/</span>, { <span style="color:#a6e22e">tag</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;A&#34;</span> });
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">tokenizer</span>.<span style="color:#a6e22e">add</span>(<span style="color:#e6db74">/pattern/</span>, { <span style="color:#a6e22e">tag</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;B&#34;</span>, <span style="color:#a6e22e">activeStates</span>: <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Set</span>() });
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">tokenizer</span>.<span style="color:#a6e22e">add</span>(<span style="color:#e6db74">/pattern/</span>, { <span style="color:#a6e22e">tag</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;C&#34;</span>, <span style="color:#a6e22e">activeStates</span>: <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Set</span>([<span style="color:#e6db74">&#34;*&#34;</span>]) });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// This only matches in INITIAL state
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">tokenizer</span>.<span style="color:#a6e22e">add</span>(<span style="color:#e6db74">/pattern/</span>, { <span style="color:#a6e22e">tag</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;D&#34;</span>, <span style="color:#a6e22e">activeStates</span>: <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Set</span>([<span style="color:#e6db74">&#34;INITIAL&#34;</span>]) });
</span></span></code></pre></code></pre><h2 id="managing-state-transitions">Managing State Transitions <a class="anchor" href="#managing-state-transitions">¶</a></h2>
<p>State transitions are managed through match callbacks. Track the current state and update it when appropriate tokens are matched:</p>
<pre><code><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;"><code><span style="display:flex;"><span><span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">Tokenizer</span>, <span style="color:#a6e22e">Tape</span> } <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#34;tlex&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// State management
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">currentState</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;INITIAL&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">stateStack</span>: <span style="color:#66d9ef">string</span>[] <span style="color:#f92672">=</span> [];
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">pushState</span>(<span style="color:#a6e22e">state</span>: <span style="color:#66d9ef">string</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">stateStack</span>.<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">currentState</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">currentState</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">state</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">popState</span>()<span style="color:#f92672">:</span> <span style="color:#66d9ef">string</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">currentState</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">stateStack</span>.<span style="color:#a6e22e">pop</span>() <span style="color:#f92672">||</span> <span style="color:#e6db74">&#34;INITIAL&#34;</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">currentState</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">tokenizer</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Tokenizer</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Enter STRING state on opening quote
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">tokenizer</span>.<span style="color:#a6e22e">add</span>(<span style="color:#e6db74">/&#34;/</span>, { <span style="color:#a6e22e">tag</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;STRING_START&#34;</span> }, (<span style="color:#a6e22e">rule</span>, <span style="color:#a6e22e">tape</span>, <span style="color:#a6e22e">token</span>) <span style="color:#f92672">=&gt;</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">pushState</span>(<span style="color:#e6db74">&#34;STRING&#34;</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">token</span>;
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Exit STRING state on closing quote
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">tokenizer</span>.<span style="color:#a6e22e">add</span>(<span style="color:#e6db74">/&#34;/</span>, {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">tag</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;STRING_END&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">activeStates</span>: <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Set</span>([<span style="color:#e6db74">&#34;STRING&#34;</span>])
</span></span><span style="display:flex;"><span>}, (<span style="color:#a6e22e">rule</span>, <span style="color:#a6e22e">tape</span>, <span style="color:#a6e22e">token</span>) <span style="color:#f92672">=&gt;</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">popState</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">token</span>;
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// String content only in STRING state
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">tokenizer</span>.<span style="color:#a6e22e">add</span>(<span style="color:#e6db74">/[^&#34;\\]+/</span>, {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">tag</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;STRING_CONTENT&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">activeStates</span>: <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Set</span>([<span style="color:#e6db74">&#34;STRING&#34;</span>])
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Escape sequences in STRING state
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">tokenizer</span>.<span style="color:#a6e22e">add</span>(<span style="color:#e6db74">/\\./</span>, {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">tag</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;ESCAPE_SEQUENCE&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">activeStates</span>: <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Set</span>([<span style="color:#e6db74">&#34;STRING&#34;</span>])
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></code></pre><h2 id="example-string-literal-parsing">Example: String Literal Parsing <a class="anchor" href="#example-string-literal-parsing">¶</a></h2>
<p>Complete example for parsing string literals with escape sequences:</p>
<pre><code><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;"><code><span style="display:flex;"><span><span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">Tokenizer</span>, <span style="color:#a6e22e">Token</span>, <span style="color:#a6e22e">Tape</span> } <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#34;tlex&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">inString</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">tokenizer</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Tokenizer</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Normal tokens (outside strings)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">tokenizer</span>.<span style="color:#a6e22e">add</span>(<span style="color:#e6db74">/[a-zA-Z_][a-zA-Z0-9_]*/</span>, { <span style="color:#a6e22e">tag</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;IDENTIFIER&#34;</span> });
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">tokenizer</span>.<span style="color:#a6e22e">add</span>(<span style="color:#e6db74">/[0-9]+/</span>, { <span style="color:#a6e22e">tag</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;NUMBER&#34;</span> });
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">tokenizer</span>.<span style="color:#a6e22e">add</span>(<span style="color:#e6db74">/\s+/</span>, { <span style="color:#a6e22e">skip</span>: <span style="color:#66d9ef">true</span> });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Opening quote - enter string mode
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">tokenizer</span>.<span style="color:#a6e22e">add</span>(<span style="color:#e6db74">/&#34;/</span>, { <span style="color:#a6e22e">tag</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;STRING_START&#34;</span> }, (<span style="color:#a6e22e">rule</span>, <span style="color:#a6e22e">tape</span>, <span style="color:#a6e22e">token</span>) <span style="color:#f92672">=&gt;</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">inString</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">token</span>;
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Closing quote - exit string mode (only when in string)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">tokenizer</span>.<span style="color:#a6e22e">add</span>(<span style="color:#e6db74">/&#34;/</span>, {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">tag</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;STRING_END&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">activeStates</span>: <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Set</span>([<span style="color:#e6db74">&#34;STRING&#34;</span>])
</span></span><span style="display:flex;"><span>}, (<span style="color:#a6e22e">rule</span>, <span style="color:#a6e22e">tape</span>, <span style="color:#a6e22e">token</span>) <span style="color:#f92672">=&gt;</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">inString</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">token</span>;
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// String content
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">tokenizer</span>.<span style="color:#a6e22e">add</span>(<span style="color:#e6db74">/[^&#34;\\]+/</span>, {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">tag</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;STRING_CHARS&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">activeStates</span>: <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Set</span>([<span style="color:#e6db74">&#34;STRING&#34;</span>])
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Escape sequences
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">tokenizer</span>.<span style="color:#a6e22e">add</span>(<span style="color:#e6db74">/\\[nrt&#34;\\]/</span>, {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">tag</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;ESCAPE&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">activeStates</span>: <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Set</span>([<span style="color:#e6db74">&#34;STRING&#34;</span>])
</span></span><span style="display:flex;"><span>}, (<span style="color:#a6e22e">rule</span>, <span style="color:#a6e22e">tape</span>, <span style="color:#a6e22e">token</span>) <span style="color:#f92672">=&gt;</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">escapeMap</span>: <span style="color:#66d9ef">Record</span>&lt;<span style="color:#f92672">string</span><span style="color:#960050;background-color:#1e0010">,</span> <span style="color:#a6e22e">string</span>&gt; <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;\\n&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;\n&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;\\r&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;\r&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;\\t&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;\t&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;\\&#34;&#39;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;&#34;&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;\\\\&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;\\&#34;</span>
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">token</span>.<span style="color:#a6e22e">value</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">escapeMap</span>[<span style="color:#a6e22e">token</span>.<span style="color:#a6e22e">value</span>] <span style="color:#f92672">||</span> <span style="color:#a6e22e">token</span>.<span style="color:#a6e22e">value</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">token</span>;
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></code></pre><h2 id="example-block-comments">Example: Block Comments <a class="anchor" href="#example-block-comments">¶</a></h2>
<p>Handling C-style block comments:</p>
<pre><code><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;"><code><span style="display:flex;"><span><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">commentDepth</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">tokenizer</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Tokenizer</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Enter comment
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">tokenizer</span>.<span style="color:#a6e22e">add</span>(<span style="color:#e6db74">/\/\*/</span>, { <span style="color:#a6e22e">tag</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;COMMENT_START&#34;</span> }, (<span style="color:#a6e22e">rule</span>, <span style="color:#a6e22e">tape</span>, <span style="color:#a6e22e">token</span>) <span style="color:#f92672">=&gt;</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">commentDepth</span><span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">token</span>;
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Exit comment (only when in comment)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">tokenizer</span>.<span style="color:#a6e22e">add</span>(<span style="color:#e6db74">/\*\//</span>, {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">tag</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;COMMENT_END&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">activeStates</span>: <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Set</span>([<span style="color:#e6db74">&#34;COMMENT&#34;</span>])
</span></span><span style="display:flex;"><span>}, (<span style="color:#a6e22e">rule</span>, <span style="color:#a6e22e">tape</span>, <span style="color:#a6e22e">token</span>) <span style="color:#f92672">=&gt;</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">commentDepth</span><span style="color:#f92672">--</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">commentDepth</span> <span style="color:#f92672">===</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">?</span> <span style="color:#a6e22e">token</span> : <span style="color:#66d9ef">null</span>; <span style="color:#75715e">// Only emit when fully exited
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Comment content
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">tokenizer</span>.<span style="color:#a6e22e">add</span>(<span style="color:#e6db74">/[^*]+|\*(?!\/)/</span>, {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">tag</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;COMMENT_CONTENT&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">activeStates</span>: <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Set</span>([<span style="color:#e6db74">&#34;COMMENT&#34;</span>]),
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">skip</span>: <span style="color:#66d9ef">true</span> <span style="color:#75715e">// Skip comment content
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Regular tokens (outside comments)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">tokenizer</span>.<span style="color:#a6e22e">add</span>(<span style="color:#e6db74">/[a-z]+/</span>, { <span style="color:#a6e22e">tag</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;WORD&#34;</span> });
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">tokenizer</span>.<span style="color:#a6e22e">add</span>(<span style="color:#e6db74">/\s+/</span>, { <span style="color:#a6e22e">skip</span>: <span style="color:#66d9ef">true</span> });
</span></span></code></pre></code></pre><h2 id="example-nested-structures">Example: Nested Structures <a class="anchor" href="#example-nested-structures">¶</a></h2>
<p>Handling nested braces with depth tracking:</p>
<pre><code><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;"><code><span style="display:flex;"><span><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">braceDepth</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">tokenizer</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Tokenizer</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">tokenizer</span>.<span style="color:#a6e22e">add</span>(<span style="color:#e6db74">/\{/</span>, { <span style="color:#a6e22e">tag</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;OPEN_BRACE&#34;</span> }, (<span style="color:#a6e22e">rule</span>, <span style="color:#a6e22e">tape</span>, <span style="color:#a6e22e">token</span>) <span style="color:#f92672">=&gt;</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">braceDepth</span><span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">token</span>.<span style="color:#a6e22e">depth</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">braceDepth</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">token</span>;
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">tokenizer</span>.<span style="color:#a6e22e">add</span>(<span style="color:#e6db74">/\}/</span>, { <span style="color:#a6e22e">tag</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;CLOSE_BRACE&#34;</span> }, (<span style="color:#a6e22e">rule</span>, <span style="color:#a6e22e">tape</span>, <span style="color:#a6e22e">token</span>) <span style="color:#f92672">=&gt;</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">token</span>.<span style="color:#a6e22e">depth</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">braceDepth</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">braceDepth</span><span style="color:#f92672">--</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">braceDepth</span> <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> Error(<span style="color:#e6db74">&#34;Unmatched closing brace&#34;</span>);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">token</span>;
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Content inside braces (depth &gt; 0)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">tokenizer</span>.<span style="color:#a6e22e">add</span>(<span style="color:#e6db74">/[^{}]+/</span>, {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">tag</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;BRACE_CONTENT&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">activeStates</span>: <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Set</span>([<span style="color:#e6db74">&#34;BRACES&#34;</span>])
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></code></pre><h2 id="state-aware-priority">State-Aware Priority <a class="anchor" href="#state-aware-priority">¶</a></h2>
<p>When combining states with priority, both are considered:</p>
<pre><code><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;"><code><span style="display:flex;"><span><span style="color:#75715e">// In STRING state, escape has higher priority than content
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">tokenizer</span>.<span style="color:#a6e22e">add</span>(<span style="color:#e6db74">/\\./</span>, {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">tag</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;ESCAPE&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">priority</span>: <span style="color:#66d9ef">10</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">activeStates</span>: <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Set</span>([<span style="color:#e6db74">&#34;STRING&#34;</span>])
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">tokenizer</span>.<span style="color:#a6e22e">add</span>(<span style="color:#e6db74">/[^&#34;\\]+/</span>, {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">tag</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;CONTENT&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">priority</span>: <span style="color:#66d9ef">0</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">activeStates</span>: <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Set</span>([<span style="color:#e6db74">&#34;STRING&#34;</span>])
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></code></pre><h2 id="best-practices">Best Practices <a class="anchor" href="#best-practices">¶</a></h2>
<ol>
<li>
<p><strong>Use INITIAL for default state</strong> - Convention from Flex, represents the starting state</p>
</li>
<li>
<p><strong>Keep state logic simple</strong> - Complex state machines are hard to debug</p>
</li>
<li>
<p><strong>Pair enter/exit rules</strong> - Every state entry should have a corresponding exit</p>
</li>
<li>
<p><strong>Consider alternatives</strong> - For simple cases, lookahead/lookbehind may be simpler than states</p>
</li>
<li>
<p><strong>Track depth for nesting</strong> - Use a counter for structures that can nest</p>
</li>
<li>
<p><strong>Handle errors</strong> - Check for unterminated strings/comments at end of input</p>
</li>
</ol>
<h2 id="comparison-with-flex">Comparison with Flex <a class="anchor" href="#comparison-with-flex">¶</a></h2>
<table>
<thead>
<tr>
<th>Feature</th>
<th>TLEX</th>
<th>Flex</th>
</tr>
</thead>
<tbody>
<tr>
<td>State declaration</td>
<td>Implicit (used in rules)</td>
<td><code>%s STATE</code> or <code>%x STATE</code></td>
</tr>
<tr>
<td>State restriction</td>
<td><code>activeStates: new Set([...])</code></td>
<td><code>&lt;STATE&gt;pattern</code></td>
</tr>
<tr>
<td>State transition</td>
<td>Manual in callbacks</td>
<td><code>BEGIN(STATE)</code></td>
</tr>
<tr>
<td>State stack</td>
<td>Manual implementation</td>
<td><code>yy_push_state()</code>, <code>yy_pop_state()</code></td>
</tr>
<tr>
<td>Inclusive states</td>
<td>Use <code>&quot;*&quot;</code> wildcard</td>
<td><code>%s</code> declaration</td>
</tr>
<tr>
<td>Exclusive states</td>
<td>Default behavior</td>
<td><code>%x</code> declaration</td>
</tr>
</tbody>
</table>

        
    </div>

    
    
</article>

        </main>
    </div>
    

    
    
    
<footer class="site-footer">
    <div class="footer-container">
        <div class="footer-section">
            <h4>TLEX</h4>
            <p>A powerful lexer generator and tokenizer library for TypeScript</p>
            <p class="version">Version 1.0.0</p>
        </div>

        <div class="footer-section">
            <h4>Quick Links</h4>
            <ul>
                <li><a href="/tlex/getting-started/">Getting Started</a></li>
                <li><a href="/tlex/concepts/">Concepts</a></li>
                <li><a href="/tlex/reference/">Reference</a></li>
                <li><a href="/tlex/examples/">Examples</a></li>
            </ul>
        </div>

        <div class="footer-section">
            <h4>Community</h4>
            <ul>
                <li><a href="https://github.com/panyam/tlex" target="_blank" rel="noopener">GitHub Repository</a></li>
                <li><a href="https://github.com/panyam/tlex/issues" target="_blank" rel="noopener">Report Issues</a></li>
                <li><a href="https://www.npmjs.com/package/tlex" target="_blank" rel="noopener">npm Package</a></li>
            </ul>
        </div>

        <div class="footer-section">
            <h4>License</h4>
            <p>Licensed under <a href="https://github.com/panyam/tlex/blob/master/LICENSE">MIT</a></p>
            <p>&copy;  Sriram Panyam</p>
        </div>
    </div>

    <div class="footer-bottom">
        <p>Built with <a href="https://github.com/panyam/s3gen" target="_blank">s3gen</a></p>
    </div>
</footer>

    

    
    
    <script defer="defer" src="/tlex/static/js/gen/59.53f8ed6f679c11016011.js"></script>
<script defer="defer" src="/tlex/static/js/gen/513.f5749b8d6a5fba145786.js"></script>
<script defer="defer" src="/tlex/static/js/gen/DocsPage.c50725eb494e4eb17a75.js"></script>
    

    
    <script>
        (function() {
            var toggle = document.getElementById('theme-toggle');
            if (toggle) {
                toggle.addEventListener('click', function() {
                    var isDark = document.documentElement.classList.toggle('dark');
                    localStorage.setItem('theme', isDark ? 'dark' : 'light');
                });
            }
        })();
    </script>
</body>
</html>
